# XPC3002: Consider using modern image registration API

## Severity

Info (Suggestion)

## Description

This rule reports when `AddImage()` is used for image registration. While `AddImage()` is fully functional (especially when combined with `nameof()`), the modern `WithPreImage()` and `WithPostImage()` APIs provide a cleaner syntax and express intent more clearly.

## ❌ Examples of code that triggers this suggestion

### Using AddImage with nameof()

```csharp
public class AccountPlugin : Plugin
{
    public AccountPlugin()
    {
        // XPC3002 reported on AddImage
        RegisterStep<Account, IAccountService>(
            EventOperation.Update,
            ExecutionStage.PostOperation,
            nameof(IAccountService.HandleUpdate))
            .AddImage(ImageType.PreImage, x => x.Name);
    }
}
```

### Using AddImage with lambda invocation

```csharp
public class AccountPlugin : Plugin
{
    public AccountPlugin()
    {
        // XPC3002 reported on AddImage
        RegisterStep<Account, IAccountService>(
            EventOperation.Update,
            ExecutionStage.PostOperation,
            s => s.HandleUpdate())
            .AddImage(ImageType.PreImage, x => x.Name);
    }
}
```

## ✅ How to fix

Convert `AddImage(ImageType.PreImage, ...)` to `WithPreImage(...)` and `AddImage(ImageType.PostImage, ...)` to `WithPostImage(...)`:

```csharp
public class AccountPlugin : Plugin
{
    public AccountPlugin()
    {
        RegisterStep<Account, IAccountService>(
            EventOperation.Update,
            ExecutionStage.PostOperation,
            nameof(IAccountService.HandleUpdate))
            .WithPreImage(x => x.Name);
    }
}
```

## Why this matters

1. **Cleaner API**: `WithPreImage()` and `WithPostImage()` are more readable and express intent more clearly than the generic `AddImage(ImageType.PreImage/PostImage, ...)` pattern.

2. **Type-safe wrapper generation**: Both APIs support type-safe wrapper generation when used with `nameof()` or method reference syntax.

3. **Consistency**: Using the modern API ensures consistency across your codebase.

## When to suppress

This is an informational suggestion. You may choose to keep using `AddImage()` if:
- You're maintaining legacy code and don't want to refactor
- You prefer the explicit `ImageType` parameter

## See also

- [XPC3003: Image registration without method reference](XPC3003.md)
- [XPC3001: Prefer nameof over string literal](XPC3001.md)
